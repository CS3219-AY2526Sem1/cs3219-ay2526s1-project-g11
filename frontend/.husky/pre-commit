# Tool: ChatGPT (model: GPT-5), date: 2025-09-28
# Prompt: Generate a pre-commit hook script for a monorepo with frontend and backend. Only lint the frontend for now, the script should only process staged files in the frontend directory.
# Author review: I validated the processes, adjusted the directory paths, and removed redundant lines.

# Get staged frontend files
FRONTEND_FILES=$(git diff --cached --name-only | grep "^frontend/" || true)

if [ -n "$FRONTEND_FILES" ]; then
    echo "üöÄ Pre-commit hook running..."
    echo "üìã Frontend files staged:"
    echo "$FRONTEND_FILES" | head -5
    
    # Get the frontend directory path
    SCRIPT_DIR="$(dirname "$0")"
    FRONTEND_DIR="$(dirname "$SCRIPT_DIR")"
    
    # Check if frontend tools are available
    if ! command -v pnpm >/dev/null 2>&1; then
        echo "‚ö†Ô∏è  pnpm not found - skipping frontend linting"
        echo "   Install with: npm install -g pnpm"
        echo "   Then run: cd frontend && pnpm install"
        exit 0  # Don't fail the commit
    fi
    
    if [ ! -f "$FRONTEND_DIR/package.json" ]; then
        echo "‚ö†Ô∏è  Frontend not set up - skipping linting"
        echo "   Run: cd frontend && pnpm install"
        exit 0  # Don't fail the commit
    fi
    
    echo "üîç Running TypeScript check..."
    cd frontend && pnpm tsc --noEmit
    if [ $? -ne 0 ]; then
        echo "‚ùå TypeScript check failed"
        exit 1
    fi

    echo "üîç Running lint-staged..."
    pnpm lint-staged
    if [ $? -ne 0 ]; then
        echo "‚ùå Linting failed"
        exit 1
    fi
    
    echo "‚úÖ Frontend linting completed"
    echo "‚úÖ Pre-commit hook completed"
else
    echo "‚ÑπÔ∏è  No frontend files staged, skipping frontend checks"
fi